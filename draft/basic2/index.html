<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="stylesheet" href="/umi.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.2.22
    </script>
    <title>MySQL基础2</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" href="/">MySQL手册</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/basic">基础知识</a><a aria-current="page" class="active" href="/draft">草稿箱</a><a href="/wiki">Wiki</a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" href="/"></a><h1>MySQL手册</h1><p>MySQL手册</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/basic">基础知识</a></li><li><a aria-current="page" class="active" href="/draft">草稿箱</a></li><li><a href="/wiki">Wiki</a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/draft/basic1">MySQL基础1</a></li><li><a aria-current="page" class="active" href="/draft/basic2">MySQL基础2</a></li><li><a href="/draft/basic3">MySQL基础3</a></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="1. 什么是聚合函数" data-depth="2" class=""><a href="/draft/basic2#1-什么是聚合函数"><span>1. 什么是聚合函数</span></a></li><li title="1.1 SUM" data-depth="3" class=""><a href="/draft/basic2#11-sum"><span>1.1 SUM</span></a></li><li title="1.2 AVG" data-depth="3" class=""><a href="/draft/basic2#12-avg"><span>1.2 AVG</span></a></li><li title="1.3 MAX、MIN" data-depth="3" class=""><a href="/draft/basic2#13-max、min"><span>1.3 MAX、MIN</span></a></li><li title="1.4 AVG" data-depth="3" class=""><a href="/draft/basic2#14-avg"><span>1.4 AVG</span></a></li><li title="1.5 COUNT" data-depth="3" class=""><a href="/draft/basic2#15-count"><span>1.5 COUNT</span></a></li><li title="2. 分组" data-depth="2" class=""><a href="/draft/basic2#2-分组"><span>2. 分组</span></a></li><li title="2.1 语法" data-depth="3" class=""><a href="/draft/basic2#21-语法"><span>2.1 语法</span></a></li><li title="2.2 练习" data-depth="3" class=""><a href="/draft/basic2#22-练习"><span>2.2 练习</span></a></li><li title="2.3 分组筛选" data-depth="3" class=""><a href="/draft/basic2#23-分组筛选"><span>2.3 分组筛选</span></a></li><li title="3. 子查询" data-depth="2" class=""><a href="/draft/basic2#3-子查询"><span>3. 子查询</span></a></li><li title="3.1 比较运算符的子查询" data-depth="3" class=""><a href="/draft/basic2#31-比较运算符的子查询"><span>3.1 比较运算符的子查询</span></a></li><li title="3.2 查询年龄大于平均年龄的学生" data-depth="3" class=""><a href="/draft/basic2#32-查询年龄大于平均年龄的学生"><span>3.2 查询年龄大于平均年龄的学生</span></a></li><li title="3.2 ANY SOME ALL" data-depth="3" class=""><a href="/draft/basic2#32-any-some-all"><span>3.2 ANY SOME ALL</span></a></li><li title="3.3 查询一下有考试成绩的学生信息" data-depth="3" class=""><a href="/draft/basic2#33-查询一下有考试成绩的学生信息"><span>3.3 查询一下有考试成绩的学生信息</span></a></li><li title="4. 表连接" data-depth="2" class=""><a href="/draft/basic2#4-表连接"><span>4. 表连接</span></a></li><li title="4.1　连接类型" data-depth="3" class=""><a href="/draft/basic2#41-连接类型"><span>4.1　连接类型</span></a></li><li title="4.2　连接条件" data-depth="3" class=""><a href="/draft/basic2#42-连接条件"><span>4.2　连接条件</span></a></li><li title="4.3　内连接" data-depth="3" class=""><a href="/draft/basic2#43-内连接"><span>4.3　内连接</span></a></li><li title="4.4　左外连接" data-depth="3" class=""><a href="/draft/basic2#44-左外连接"><span>4.4　左外连接</span></a></li><li title="4.5　右外连接" data-depth="3" class=""><a href="/draft/basic2#45-右外连接"><span>4.5　右外连接</span></a></li><li title="4.6　多表连接" data-depth="3" class=""><a href="/draft/basic2#46-多表连接"><span>4.6　多表连接</span></a></li><li title="4.7　无限分类[自身连接]" data-depth="3" class=""><a href="/draft/basic2#47-无限分类自身连接"><span>4.7　无限分类[自身连接]</span></a></li><li title="4.8 删除重复记录[多表删除]" data-depth="3" class=""><a href="/draft/basic2#48-删除重复记录多表删除"><span>4.8 删除重复记录[多表删除]</span></a></li><li title="4.9 多表更新" data-depth="3" class=""><a href="/draft/basic2#49-多表更新"><span>4.9 多表更新</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="mysql基础2"><a aria-hidden="true" href="#mysql基础2"><span class="icon icon-link"></span></a>MySQL基础2</h1><h2 id="1-什么是聚合函数"><a aria-hidden="true" href="#1-什么是聚合函数"><span class="icon icon-link"></span></a>1. 什么是聚合函数</h2><p>对一组值进行计算，并返回计算后的值，一般用来统计数据</p><h3 id="11-sum"><a aria-hidden="true" href="#11-sum"><span class="icon icon-link"></span></a>1.1 SUM</h3><p>累加所有行的值</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="计算ID=1的学生的的总分
select SUM(grade)  as &#x27;总分&#x27; from score where student_id = 1;
" data-status="copy"></button><div class="token-line"><span class="token plain">计算ID</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain">的学生的的总分</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">select</span><span class="token plain"> </span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token plain">grade</span><span class="token punctuation">)</span><span class="token plain">  </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token string">&#x27;总分&#x27;</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> score </span><span class="token keyword">where</span><span class="token plain"> student_id </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="12-avg"><a aria-hidden="true" href="#12-avg"><span class="icon icon-link"></span></a>1.2 AVG</h3><p>计算所有行的平均值</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="计算ID=1的学生的的平均分
select AVG(grade) as &#x27;平均分&#x27; from score where student_id = 1;
" data-status="copy"></button><div class="token-line"><span class="token plain">计算ID</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain">的学生的的平均分</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">select</span><span class="token plain"> </span><span class="token function">AVG</span><span class="token punctuation">(</span><span class="token plain">grade</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token string">&#x27;平均分&#x27;</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> score </span><span class="token keyword">where</span><span class="token plain"> student_id </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="13-max、min"><a aria-hidden="true" href="#13-max、min"><span class="icon icon-link"></span></a>1.3 MAX、MIN</h3><ul><li>计算所有行的最大值和最小值</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="select MAX(grade) 最高分,MIN(grade) 最低分 from score where student_id = 1;
" data-status="copy"></button><div class="token-line"><span class="token keyword">select</span><span class="token plain"> </span><span class="token function">MAX</span><span class="token punctuation">(</span><span class="token plain">grade</span><span class="token punctuation">)</span><span class="token plain"> 最高分</span><span class="token punctuation">,</span><span class="token function">MIN</span><span class="token punctuation">(</span><span class="token plain">grade</span><span class="token punctuation">)</span><span class="token plain"> 最低分 </span><span class="token keyword">from</span><span class="token plain"> score </span><span class="token keyword">where</span><span class="token plain"> student_id </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="14-avg"><a aria-hidden="true" href="#14-avg"><span class="icon icon-link"></span></a>1.4 AVG</h3><ul><li>计算所有行的平均值</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="select AVG(grade) as &#x27;平均分&#x27; 最低分 from score where student_id = 1;
" data-status="copy"></button><div class="token-line"><span class="token keyword">select</span><span class="token plain"> </span><span class="token function">AVG</span><span class="token punctuation">(</span><span class="token plain">grade</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token string">&#x27;平均分&#x27;</span><span class="token plain"> 最低分 </span><span class="token keyword">from</span><span class="token plain"> score </span><span class="token keyword">where</span><span class="token plain"> student_id </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="15-count"><a aria-hidden="true" href="#15-count"><span class="icon icon-link"></span></a>1.5 COUNT</h3><ul><li>计算值不为NULL的行</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="select COUNT(*) from student;
select COUNT(1) from student;
select COUNT(name) from student;
select COUNT(NULL) from student;
" data-status="copy"></button><div class="token-line"><span class="token keyword">select</span><span class="token plain"> </span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> student</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">select</span><span class="token plain"> </span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> student</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">select</span><span class="token plain"> </span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> student</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">select</span><span class="token plain"> </span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> student</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="2-分组"><a aria-hidden="true" href="#2-分组"><span class="icon icon-link"></span></a>2. 分组</h2><p>分组查询就是按某列的值进行分组，相同的值分成一组，然后可以对此组内进行求平均、求和等计算</p><p><img src="https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2020-10-01-040018.png" alt="splitgroup"/></p><h3 id="21-语法"><a aria-hidden="true" href="#21-语法"><span class="icon icon-link"></span></a>2.1 语法</h3><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT 列名,查询表达式
FROM  &lt;表名&gt;  
WHERE  &lt;条件&gt;
GROUP BY &lt;分组字段&gt;
HAVING 分组后的过滤条件
ORDER BY 列名 [ASC,DESC]
LIMIT 偏移量,条数
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> 列名</span><span class="token punctuation">,</span><span class="token plain">查询表达式</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">FROM</span><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">表名</span><span class="token operator">&gt;</span><span class="token plain">  </span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">WHERE</span><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">条件</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">GROUP</span><span class="token plain"> </span><span class="token keyword">BY</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">分组字段</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">HAVING</span><span class="token plain"> 分组后的过滤条件</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">ORDER</span><span class="token plain"> </span><span class="token keyword">BY</span><span class="token plain"> 列名 </span><span class="token punctuation">[</span><span class="token keyword">ASC</span><span class="token punctuation">,</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">LIMIT</span><span class="token plain"> 偏移量</span><span class="token punctuation">,</span><span class="token plain">条数</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>SELECT列表中只能包含：</p><ul><li>被分组的列</li><li>为每个分组返回一个值的表达式，如聚合函数</li></ul><h3 id="22-练习"><a aria-hidden="true" href="#22-练习"><span class="icon icon-link"></span></a>2.2 练习</h3><ul><li>统计每位同学的平均成绩-单列分组</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="select student_id,avg(grade) from score group by student_id;
" data-status="copy"></button><div class="token-line"><span class="token keyword">select</span><span class="token plain"> student_id</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token plain">grade</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> score </span><span class="token keyword">group</span><span class="token plain"> </span><span class="token keyword">by</span><span class="token plain"> student_id</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li>统计每门课程的最高分，并按分数从高到低排列</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="select course_id,max(grade) 平均分 from score group by course_id order by max(grade) desc
" data-status="copy"></button><div class="token-line"><span class="token keyword">select</span><span class="token plain"> course_id</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token plain">grade</span><span class="token punctuation">)</span><span class="token plain"> 平均分 </span><span class="token keyword">from</span><span class="token plain"> score </span><span class="token keyword">group</span><span class="token plain"> </span><span class="token keyword">by</span><span class="token plain"> course_id </span><span class="token keyword">order</span><span class="token plain"> </span><span class="token keyword">by</span><span class="token plain"> </span><span class="token function">max</span><span class="token punctuation">(</span><span class="token plain">grade</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">desc</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li>统计各省的男女同学人数-多列分组</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="select province,gender,COUNT(*) from student group by province,gender
" data-status="copy"></button><div class="token-line"><span class="token keyword">select</span><span class="token plain"> province</span><span class="token punctuation">,</span><span class="token plain">gender</span><span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> student </span><span class="token keyword">group</span><span class="token plain"> </span><span class="token keyword">by</span><span class="token plain"> province</span><span class="token punctuation">,</span><span class="token plain">gender</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="23-分组筛选"><a aria-hidden="true" href="#23-分组筛选"><span class="icon icon-link"></span></a>2.3 分组筛选</h3><h4 id="231-语法"><a aria-hidden="true" href="#231-语法"><span class="icon icon-link"></span></a>2.3.1 语法</h4><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT  FROM  &lt;表名&gt;
WHERE 
GROUP BY {col_name|expr|position}
HAVING  {col_name|expr|position}
ORDER BY {col_name|expr|position} [ASC|DESC]
LIMIT offset,row_count
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain">  </span><span class="token keyword">FROM</span><span class="token plain">  </span><span class="token operator">&lt;</span><span class="token plain">表名</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">WHERE</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">GROUP</span><span class="token plain"> </span><span class="token keyword">BY</span><span class="token plain"> {col_name</span><span class="token operator">|</span><span class="token plain">expr</span><span class="token operator">|</span><span class="token plain">position}</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">HAVING</span><span class="token plain">  {col_name</span><span class="token operator">|</span><span class="token plain">expr</span><span class="token operator">|</span><span class="token plain">position}</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">ORDER</span><span class="token plain"> </span><span class="token keyword">BY</span><span class="token plain"> {col_name</span><span class="token operator">|</span><span class="token plain">expr</span><span class="token operator">|</span><span class="token plain">position} </span><span class="token punctuation">[</span><span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">LIMIT</span><span class="token plain"> </span><span class="token keyword">offset</span><span class="token punctuation">,</span><span class="token plain">row_count</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ol><li>WHERE用于过滤掉不符合条件的记录</li><li>HAVING 用于过滤分组后的记录</li><li>GROUP BY用于对筛选后的结果进行分组</li></ol><h4 id="232-练习"><a aria-hidden="true" href="#232-练习"><span class="icon icon-link"></span></a>2.3.2 练习</h4><ul><li>统计学生人数超过1人的省份</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="select province,COUNT(*) from student group by province having COUNT(*)&gt;1
" data-status="copy"></button><div class="token-line"><span class="token keyword">select</span><span class="token plain"> province</span><span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> student </span><span class="token keyword">group</span><span class="token plain"> </span><span class="token keyword">by</span><span class="token plain"> province </span><span class="token keyword">having</span><span class="token plain"> </span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li>不及格次数大于1次的学生</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="select student_id,COUNT(*) 不及格次数 from score where grade &lt;60 group by student_id having COUNT(*)&gt;1
" data-status="copy"></button><div class="token-line"><span class="token keyword">select</span><span class="token plain"> student_id</span><span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token plain"> 不及格次数 </span><span class="token keyword">from</span><span class="token plain"> score </span><span class="token keyword">where</span><span class="token plain"> grade </span><span class="token operator">&lt;</span><span class="token number">60</span><span class="token plain"> </span><span class="token keyword">group</span><span class="token plain"> </span><span class="token keyword">by</span><span class="token plain"> student_id </span><span class="token keyword">having</span><span class="token plain"> </span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="3-子查询"><a aria-hidden="true" href="#3-子查询"><span class="icon icon-link"></span></a>3. 子查询</h2><ul><li>子查询就是指出现在其它SQL语句中的SELECT语句,必须始终出现在圆括号中</li><li>子查询可以包含多个关键字或条件</li><li>子查询的外层查询可以是: SELECT、INSERT、UPDATE、SET等</li><li>子查询可以返回常量、一行数据、一列数据或其它子查询</li></ul><h3 id="31-比较运算符的子查询"><a aria-hidden="true" href="#31-比较运算符的子查询"><span class="icon icon-link"></span></a>3.1 比较运算符的子查询</h3><ul><li>= 等于</li><li><code>&gt;</code> 大于</li><li>&lt; 小于</li><li><code>&gt;</code>= 大于等于</li><li>&lt;= 小于等于</li><li>&lt;&gt; 不等于</li><li>!= 不等于</li><li>&lt;=&gt; 安全不等于</li></ul><h3 id="32-查询年龄大于平均年龄的学生"><a aria-hidden="true" href="#32-查询年龄大于平均年龄的学生"><span class="icon icon-link"></span></a>3.2 查询年龄大于平均年龄的学生</h3><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT ROUND(AVG(age),2) FROM student; 

SELECT * from student WHERE age &gt; (SELECT ROUND(AVG(age),2) FROM student)
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">AVG</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">FROM</span><span class="token plain"> student</span><span class="token punctuation">;</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> student </span><span class="token keyword">WHERE</span><span class="token plain"> age </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">AVG</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">FROM</span><span class="token plain"> student</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="32-any-some-all"><a aria-hidden="true" href="#32-any-some-all"><span class="icon icon-link"></span></a>3.2 ANY SOME ALL</h3><ul><li><p><code>&gt; &gt; = &lt; &lt;= = &lt;&gt; !=</code></p></li><li><p>ANY 任何一个</p></li><li><p>SOME 某些</p></li><li><p>ALL 全部</p></li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="年龄大于陕西省任何一位同学
SELECT * from student WHERE age &gt; ANY (SELECT age  FROM student WHERE province = &#x27;陕西省&#x27;);
年龄大于陕西省某些同学
SELECT * from student WHERE age &gt; SOME (SELECT age  FROM student WHERE province = &#x27;陕西省&#x27;);
年龄大于陕西省所有同学
SELECT * from student WHERE age &gt; ALL (SELECT age  FROM student WHERE province = &#x27;陕西省&#x27;);
" data-status="copy"></button><div class="token-line"><span class="token plain">年龄大于陕西省任何一位同学</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> student </span><span class="token keyword">WHERE</span><span class="token plain"> age </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword">ANY</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> age  </span><span class="token keyword">FROM</span><span class="token plain"> student </span><span class="token keyword">WHERE</span><span class="token plain"> province </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;陕西省&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">年龄大于陕西省某些同学</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> student </span><span class="token keyword">WHERE</span><span class="token plain"> age </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword">SOME</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> age  </span><span class="token keyword">FROM</span><span class="token plain"> student </span><span class="token keyword">WHERE</span><span class="token plain"> province </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;陕西省&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">年龄大于陕西省所有同学</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> student </span><span class="token keyword">WHERE</span><span class="token plain"> age </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token keyword">ALL</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> age  </span><span class="token keyword">FROM</span><span class="token plain"> student </span><span class="token keyword">WHERE</span><span class="token plain"> province </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;陕西省&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="33-查询一下有考试成绩的学生信息"><a aria-hidden="true" href="#33-查询一下有考试成绩的学生信息"><span class="icon icon-link"></span></a>3.3 查询一下有考试成绩的学生信息</h3><ul><li>[IN]</li><li>[NOT IN]</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT * FROM student where id in (SELECT distinct student_id from score);
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">FROM</span><span class="token plain"> student </span><span class="token keyword">where</span><span class="token plain"> id </span><span class="token operator">in</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token keyword">distinct</span><span class="token plain"> student_id </span><span class="token keyword">from</span><span class="token plain"> score</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li><p>[EXISTS]</p></li><li><p>[NOTEXISTS]</p></li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT * FROM student where EXISTS (SELECT distinct student_id from score where student.id = score.student_id  )
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">FROM</span><span class="token plain"> student </span><span class="token keyword">where</span><span class="token plain"> </span><span class="token keyword">EXISTS</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token keyword">distinct</span><span class="token plain"> student_id </span><span class="token keyword">from</span><span class="token plain"> score </span><span class="token keyword">where</span><span class="token plain"> student</span><span class="token punctuation">.</span><span class="token plain">id </span><span class="token operator">=</span><span class="token plain"> score</span><span class="token punctuation">.</span><span class="token plain">student_id  </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="4-表连接"><a aria-hidden="true" href="#4-表连接"><span class="icon icon-link"></span></a>4. 表连接</h2><h3 id="41-连接类型"><a aria-hidden="true" href="#41-连接类型"><span class="icon icon-link"></span></a>4.1　连接类型</h3><ul><li>INNER JOIN 内连接</li><li>LEFT JOIN 左外连接</li><li>RIGHT JOIN 右外连接</li><li>ON 连接条件</li></ul><p><img src="https://wsk-mweb.oss-cn-hangzhou.aliyuncs.com/ipic/2020-10-01-040010.jpg" alt="tablejoin"/></p><h3 id="42-连接条件"><a aria-hidden="true" href="#42-连接条件"><span class="icon icon-link"></span></a>4.2　连接条件</h3><p>使用ON关键字来设定连接条件，也可以使用WHERE来代替</p><ul><li>ON来设定连接条件</li><li>也可以使用WHERE来对结果进行过滤</li></ul><h3 id="43-内连接"><a aria-hidden="true" href="#43-内连接"><span class="icon icon-link"></span></a>4.3　内连接</h3><p>显示左表和右表中符合条件的</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT * FROM student INNER JOIN score ON student.id = score.student_id;
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">FROM</span><span class="token plain"> student </span><span class="token keyword">INNER</span><span class="token plain"> </span><span class="token keyword">JOIN</span><span class="token plain"> score </span><span class="token keyword">ON</span><span class="token plain"> student</span><span class="token punctuation">.</span><span class="token plain">id </span><span class="token operator">=</span><span class="token plain"> score</span><span class="token punctuation">.</span><span class="token plain">student_id</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="44-左外连接"><a aria-hidden="true" href="#44-左外连接"><span class="icon icon-link"></span></a>4.4　左外连接</h3><p>显示左表的全部和右表符合条件的</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT * FROM student LEFT JOIN score ON student.id = score.student_id;
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">FROM</span><span class="token plain"> student </span><span class="token keyword">LEFT</span><span class="token plain"> </span><span class="token keyword">JOIN</span><span class="token plain"> score </span><span class="token keyword">ON</span><span class="token plain"> student</span><span class="token punctuation">.</span><span class="token plain">id </span><span class="token operator">=</span><span class="token plain"> score</span><span class="token punctuation">.</span><span class="token plain">student_id</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="45-右外连接"><a aria-hidden="true" href="#45-右外连接"><span class="icon icon-link"></span></a>4.5　右外连接</h3><p>显示右表的全部和左表符合条件的</p><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT * FROM student RIGHT JOIN score ON student.id = score.student_id;
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">FROM</span><span class="token plain"> student </span><span class="token keyword">RIGHT</span><span class="token plain"> </span><span class="token keyword">JOIN</span><span class="token plain"> score </span><span class="token keyword">ON</span><span class="token plain"> student</span><span class="token punctuation">.</span><span class="token plain">id </span><span class="token operator">=</span><span class="token plain"> score</span><span class="token punctuation">.</span><span class="token plain">student_id</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="46-多表连接"><a aria-hidden="true" href="#46-多表连接"><span class="icon icon-link"></span></a>4.6　多表连接</h3><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT student.name,course.name,score.grade FROM score 
INNER JOIN student ON student.id = score.student_id
INNER JOIN course ON course.id = score.course_id;
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> student</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">,</span><span class="token plain">course</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">,</span><span class="token plain">score</span><span class="token punctuation">.</span><span class="token plain">grade </span><span class="token keyword">FROM</span><span class="token plain"> score </span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">INNER</span><span class="token plain"> </span><span class="token keyword">JOIN</span><span class="token plain"> student </span><span class="token keyword">ON</span><span class="token plain"> student</span><span class="token punctuation">.</span><span class="token plain">id </span><span class="token operator">=</span><span class="token plain"> score</span><span class="token punctuation">.</span><span class="token plain">student_id</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">INNER</span><span class="token plain"> </span><span class="token keyword">JOIN</span><span class="token plain"> course </span><span class="token keyword">ON</span><span class="token plain"> course</span><span class="token punctuation">.</span><span class="token plain">id </span><span class="token operator">=</span><span class="token plain"> score</span><span class="token punctuation">.</span><span class="token plain">course_id</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="47-无限分类自身连接"><a aria-hidden="true" href="#47-无限分类自身连接"><span class="icon icon-link"></span></a>4.7　无限分类[自身连接]</h3><h4 id="471-建表"><a aria-hidden="true" href="#471-建表"><span class="icon icon-link"></span></a>4.7.1 建表</h4><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="CREATE table category(
 id int(11) PRIMARY KEY AUTO_INCREMENT NOT NULL,
 name varchar(50),
 parent_id int(11)
)
" data-status="copy"></button><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">table</span><span class="token plain"> category</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"> id </span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token plain"> </span><span class="token keyword">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"> name </span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"> parent_id </span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="472-插入语句"><a aria-hidden="true" href="#472-插入语句"><span class="icon icon-link"></span></a>4.7.2 插入语句</h4><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="INSERT INTO category(id,name,parent_id)
VALUES (1,&#x27;数码产品&#x27;,0),(2,&#x27;服装&#x27;,0),(3,&#x27;食品&#x27;,0),
(4,&#x27;iPad&#x27;,1),(5,&#x27;李宁&#x27;,2),(6,&#x27;康师傅&#x27;,3);
" data-status="copy"></button><div class="token-line"><span class="token keyword">INSERT</span><span class="token plain"> </span><span class="token keyword">INTO</span><span class="token plain"> category</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">,</span><span class="token plain">name</span><span class="token punctuation">,</span><span class="token plain">parent_id</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">VALUES</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#x27;数码产品&#x27;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#x27;服装&#x27;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#x27;食品&#x27;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&#x27;iPad&#x27;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&#x27;李宁&#x27;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&#x27;康师傅&#x27;</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="473-查询所有的顶级分类下面分类的数量"><a aria-hidden="true" href="#473-查询所有的顶级分类下面分类的数量"><span class="icon icon-link"></span></a>4.7.3 查询所有的顶级分类下面分类的数量</h4><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT c1.id,c1.name,COUNT(1) 
FROM category c1 INNER JOIN category c2 ON c1.id = c2.parent_id
WHERE c1.parent_id = 0
GROUP BY c1.id;
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> c1</span><span class="token punctuation">.</span><span class="token plain">id</span><span class="token punctuation">,</span><span class="token plain">c1</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">FROM</span><span class="token plain"> category c1 </span><span class="token keyword">INNER</span><span class="token plain"> </span><span class="token keyword">JOIN</span><span class="token plain"> category c2 </span><span class="token keyword">ON</span><span class="token plain"> c1</span><span class="token punctuation">.</span><span class="token plain">id </span><span class="token operator">=</span><span class="token plain"> c2</span><span class="token punctuation">.</span><span class="token plain">parent_id</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">WHERE</span><span class="token plain"> c1</span><span class="token punctuation">.</span><span class="token plain">parent_id </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">GROUP</span><span class="token plain"> </span><span class="token keyword">BY</span><span class="token plain"> c1</span><span class="token punctuation">.</span><span class="token plain">id</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="474-父类变成名称"><a aria-hidden="true" href="#474-父类变成名称"><span class="icon icon-link"></span></a>4.7.4 父类变成名称</h4><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT c1.id,c1.name,p.name
FROM category c1 LEFT JOIN category p ON c1.parent_id = p.id
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> c1</span><span class="token punctuation">.</span><span class="token plain">id</span><span class="token punctuation">,</span><span class="token plain">c1</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">,</span><span class="token plain">p</span><span class="token punctuation">.</span><span class="token plain">name</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">FROM</span><span class="token plain"> category c1 </span><span class="token keyword">LEFT</span><span class="token plain"> </span><span class="token keyword">JOIN</span><span class="token plain"> category p </span><span class="token keyword">ON</span><span class="token plain"> c1</span><span class="token punctuation">.</span><span class="token plain">parent_id </span><span class="token operator">=</span><span class="token plain"> p</span><span class="token punctuation">.</span><span class="token plain">id</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="48-删除重复记录多表删除"><a aria-hidden="true" href="#48-删除重复记录多表删除"><span class="icon icon-link"></span></a>4.8 删除重复记录[多表删除]</h3><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="INSERT INTO category(id,name,parent_id)
VALUES
(7,&#x27;iPad&#x27;,1),
(8,&#x27;李宁&#x27;,2),
(9,&#x27;康师傅&#x27;,3);
" data-status="copy"></button><div class="token-line"><span class="token keyword">INSERT</span><span class="token plain"> </span><span class="token keyword">INTO</span><span class="token plain"> category</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">,</span><span class="token plain">name</span><span class="token punctuation">,</span><span class="token plain">parent_id</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">VALUES</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">&#x27;iPad&#x27;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">&#x27;李宁&#x27;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">&#x27;康师傅&#x27;</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="481-子查询找要删除的id"><a aria-hidden="true" href="#481-子查询找要删除的id"><span class="icon icon-link"></span></a>4.8.1 子查询找要删除的ID</h4><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT * FROM category c1 LEFT JOIN 
(SELECT id,name from category GROUP BY name HAVING COUNT(1)&gt;1) c2
ON c1.name = c2.name WHERE c1.id != c2.id
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">FROM</span><span class="token plain"> category c1 </span><span class="token keyword">LEFT</span><span class="token plain"> </span><span class="token keyword">JOIN</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> id</span><span class="token punctuation">,</span><span class="token plain">name </span><span class="token keyword">from</span><span class="token plain"> category </span><span class="token keyword">GROUP</span><span class="token plain"> </span><span class="token keyword">BY</span><span class="token plain"> name </span><span class="token keyword">HAVING</span><span class="token plain"> </span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> c2</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">ON</span><span class="token plain"> c1</span><span class="token punctuation">.</span><span class="token plain">name </span><span class="token operator">=</span><span class="token plain"> c2</span><span class="token punctuation">.</span><span class="token plain">name </span><span class="token keyword">WHERE</span><span class="token plain"> c1</span><span class="token punctuation">.</span><span class="token plain">id </span><span class="token operator">!=</span><span class="token plain"> c2</span><span class="token punctuation">.</span><span class="token plain">id</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="482-通过in找要删除的id"><a aria-hidden="true" href="#482-通过in找要删除的id"><span class="icon icon-link"></span></a>4.8.2 通过IN找要删除的ID</h4><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="SELECT * FROM category c1 
WHERE c1.name IN 
(SELECT name from category GROUP BY name HAVING COUNT(1)&gt;1)
AND c1.id NOT IN 
(SELECT MIN(id) from category GROUP BY name HAVING COUNT(1)&gt;1)
" data-status="copy"></button><div class="token-line"><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword">FROM</span><span class="token plain"> category c1 </span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">WHERE</span><span class="token plain"> c1</span><span class="token punctuation">.</span><span class="token plain">name </span><span class="token operator">IN</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> name </span><span class="token keyword">from</span><span class="token plain"> category </span><span class="token keyword">GROUP</span><span class="token plain"> </span><span class="token keyword">BY</span><span class="token plain"> name </span><span class="token keyword">HAVING</span><span class="token plain"> </span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">AND</span><span class="token plain"> c1</span><span class="token punctuation">.</span><span class="token plain">id </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token operator">IN</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token function">MIN</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> category </span><span class="token keyword">GROUP</span><span class="token plain"> </span><span class="token keyword">BY</span><span class="token plain"> name </span><span class="token keyword">HAVING</span><span class="token plain"> </span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="483-删除重复记录"><a aria-hidden="true" href="#483-删除重复记录"><span class="icon icon-link"></span></a>4.8.3 删除重复记录</h4><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="DELETE FROM category
WHERE name IN 
(SELECT NAME FROM ( SELECT name from category GROUP BY name HAVING COUNT(1)&gt;1) AS T1 )
AND id NOT IN 
(SELECT id FROM (SELECT MIN(id) id from category GROUP BY name HAVING COUNT(1)&gt;1) AS T2)
" data-status="copy"></button><div class="token-line"><span class="token keyword">DELETE</span><span class="token plain"> </span><span class="token keyword">FROM</span><span class="token plain"> category</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">WHERE</span><span class="token plain"> name </span><span class="token operator">IN</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> NAME </span><span class="token keyword">FROM</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token keyword">SELECT</span><span class="token plain"> name </span><span class="token keyword">from</span><span class="token plain"> category </span><span class="token keyword">GROUP</span><span class="token plain"> </span><span class="token keyword">BY</span><span class="token plain"> name </span><span class="token keyword">HAVING</span><span class="token plain"> </span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">AS</span><span class="token plain"> T1 </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">AND</span><span class="token plain"> id </span><span class="token operator">NOT</span><span class="token plain"> </span><span class="token operator">IN</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> id </span><span class="token keyword">FROM</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token function">MIN</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"> id </span><span class="token keyword">from</span><span class="token plain"> category </span><span class="token keyword">GROUP</span><span class="token plain"> </span><span class="token keyword">BY</span><span class="token plain"> name </span><span class="token keyword">HAVING</span><span class="token plain"> </span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">AS</span><span class="token plain"> T2</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="49-多表更新"><a aria-hidden="true" href="#49-多表更新"><span class="icon icon-link"></span></a>4.9 多表更新</h3><h4 id="491-插入省份insert-select"><a aria-hidden="true" href="#491-插入省份insert-select"><span class="icon icon-link"></span></a>4.9.1 (插入省份)INSERT SELECT</h4><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="CREATE TABLE province(id int PRIMARY KEY AUTO_INCREMENT,name varchar(50))
INSERT INTO province(name) SELECT DISTINCT province FROM student;
" data-status="copy"></button><div class="token-line"><span class="token keyword">CREATE</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> province</span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">int</span><span class="token plain"> </span><span class="token keyword">PRIMARY</span><span class="token plain"> </span><span class="token keyword">KEY</span><span class="token plain"> </span><span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span><span class="token plain">name </span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">INSERT</span><span class="token plain"> </span><span class="token keyword">INTO</span><span class="token plain"> province</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">SELECT</span><span class="token plain"> </span><span class="token keyword">DISTINCT</span><span class="token plain"> province </span><span class="token keyword">FROM</span><span class="token plain"> student</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="492-更新省份"><a aria-hidden="true" href="#492-更新省份"><span class="icon icon-link"></span></a>4.9.2　更新省份</h4><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="UPDATE student INNER JOIN province ON student.province=province.name
 SET student.province=province.id 
" data-status="copy"></button><div class="token-line"><span class="token keyword">UPDATE</span><span class="token plain"> student </span><span class="token keyword">INNER</span><span class="token plain"> </span><span class="token keyword">JOIN</span><span class="token plain"> province </span><span class="token keyword">ON</span><span class="token plain"> student</span><span class="token punctuation">.</span><span class="token plain">province</span><span class="token operator">=</span><span class="token plain">province</span><span class="token punctuation">.</span><span class="token plain">name</span></div><div class="token-line"><span class="token plain"> </span><span class="token keyword">SET</span><span class="token plain"> student</span><span class="token punctuation">.</span><span class="token plain">province</span><span class="token operator">=</span><span class="token plain">province</span><span class="token punctuation">.</span><span class="token plain">id </span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="493-修改字段"><a aria-hidden="true" href="#493-修改字段"><span class="icon icon-link"></span></a>4.9.3 修改字段</h4><div class="__dumi-default-code-block"><pre class="prism-code language-sql"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="ALTER TABLE student 
CHANGE COLUMN `province` `province_id` int(11);
" data-status="copy"></button><div class="token-line"><span class="token keyword">ALTER</span><span class="token plain"> </span><span class="token keyword">TABLE</span><span class="token plain"> student </span></div><div class="token-line"><span class="token plain">CHANGE </span><span class="token keyword">COLUMN</span><span class="token plain"> </span><span class="token punctuation">`</span><span class="token plain">province</span><span class="token punctuation">`</span><span class="token plain"> </span><span class="token punctuation">`</span><span class="token plain">province_id</span><span class="token punctuation">`</span><span class="token plain"> </span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/weisuoke/mysql-guidebook/edit/master/docs/draft/basic2.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">2020-10-1 12:09:14</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/umi.js"></script>
    <script src="/docs__draft__basic2.md.js"></script>
  </body>
</html>
